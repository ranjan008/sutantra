<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple UI Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-box { border: 2px solid #333; padding: 20px; margin: 10px 0; }
        .streamer { background-color: #e3f2fd; }
        .viewer { background-color: #f3e5f5; }
        button { padding: 10px; margin: 5px; }
        .console { background: #f5f5f5; padding: 10px; height: 200px; overflow-y: auto; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üß™ Simple UI Differentiation Test</h1>
    
    <div class="test-box">
        <h2>Current Port: <span id="current-port">Loading...</span></h2>
        <h2>Detected Type: <span id="detected-type">Loading...</span></h2>
        <h2>Server Confirmed Type: <span id="server-type">Not connected</span></h2>
    </div>

    <div class="test-box" id="ui-container">
        <h2>UI Controls:</h2>
        <div id="controls">Loading...</div>
    </div>

    <div class="test-box">
        <h2>WebSocket Test:</h2>
        <button onclick="testWebSocket()">Test WebSocket Handshake</button>
        <button onclick="clearConsole()">Clear Console</button>
    </div>

    <div class="test-box">
        <h2>Console Output:</h2>
        <div id="console" class="console"></div>
    </div>

    <script>
        let consoleDiv = document.getElementById('console');
        
        // Override console.log
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            consoleDiv.innerHTML += '<div>' + args.join(' ') + '</div>';
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };

        function clearConsole() {
            consoleDiv.innerHTML = '';
        }

        function detectNodeType() {
            const currentPort = window.location.port || '8080';
            document.getElementById('current-port').textContent = currentPort;
            
            if (currentPort === '8080') {
                return 'streamer';
            } else if (currentPort === '8081') {
                return 'viewer';
            } else {
                return 'streamer';
            }
        }

        function updateUI(nodeType) {
            const container = document.getElementById('ui-container');
            const controls = document.getElementById('controls');
            
            console.log('üé≠ Updating UI for type:', nodeType);
            
            if (nodeType === 'streamer') {
                container.className = 'test-box streamer';
                controls.innerHTML = \`
                    <button style="background: #4caf50; color: white;">‚ñ∂ Start Stream</button>
                    <button style="background: #f44336; color: white;">‚èπ Stop Stream</button>
                    <button style="background: #2196f3; color: white;">‚öô Settings</button>
                \`;
            } else if (nodeType === 'viewer') {
                container.className = 'test-box viewer';
                controls.innerHTML = \`
                    <button style="background: #ff9800; color: white;">üîÑ Refresh Streams</button>
                    <button style="background: #4caf50; color: white;">‚ñ∂ Join Stream</button>
                    <button style="background: #f44336; color: white;">‚èπ Leave Stream</button>
                    <div style="margin-top: 10px; padding: 10px; background: #fff3e0;">
                        <h4>Available Streams</h4>
                        <p>No active streams found. Click refresh to check again.</p>
                    </div>
                \`;
            }
        }

        function testWebSocket() {
            const currentPort = window.location.port || '8080';
            const wsUrl = \`ws://localhost:\${currentPort}/ws\`;
            
            console.log('üîå Testing WebSocket:', wsUrl);
            
            const ws = new WebSocket(wsUrl);
            
            ws.onopen = function() {
                console.log('‚úÖ WebSocket connected');
                
                const handshake = {
                    type: 'handshake',
                    data: { client_type: 'test' }
                };
                
                console.log('üì§ Sending handshake:', JSON.stringify(handshake));
                ws.send(JSON.stringify(handshake));
            };
            
            ws.onmessage = function(event) {
                console.log('üì• Received:', event.data);
                
                try {
                    const message = JSON.parse(event.data);
                    if (message.type === 'handshakeResponse') {
                        const serverType = message.data?.node_type;
                        console.log('üé≠ Server says node type is:', serverType);
                        
                        document.getElementById('server-type').textContent = serverType;
                        
                        // Update UI based on server response
                        updateUI(serverType);
                    }
                } catch (e) {
                    console.error('‚ùå Error parsing message:', e);
                }
                
                ws.close();
            };
            
            ws.onerror = function(error) {
                console.error('‚ùå WebSocket error:', error);
            };
            
            ws.onclose = function() {
                console.log('üîå WebSocket closed');
            };
        }

        // Initialize
        window.onload = function() {
            const detectedType = detectNodeType();
            document.getElementById('detected-type').textContent = detectedType;
            
            console.log('üöÄ Simple test page loaded');
            console.log('üéØ Detected node type:', detectedType);
            
            // Set initial UI based on detection
            updateUI(detectedType);
            
            // Auto-test WebSocket
            setTimeout(testWebSocket, 1000);
        };
    </script>
</body>
</html>

